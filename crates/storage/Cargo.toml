[package]
name = "storage"
version = "0.1.0"
edition = "2021"
description = "High-throughput storage and buffering for rust-daq"

[dependencies]
common = { path = "../common" }
pool = { path = "../pool" }
protocol = { path = "../protocol" }

serde = { workspace = true, features = ["derive"] }
serde_json.workspace = true
prost.workspace = true

# Data Handling
hdf5 = { package = "hdf5-metno", version = "0.11.0", optional = true }
arrow = { version = "57", optional = true, features = ["ipc"] }
parquet = { version = "57", optional = true, default-features = false, features = ["arrow", "async", "snap"] }
memmap2 = "0.9"

# Image formats
image = { version = "0.25", optional = true, default-features = false, features = ["tiff"] }

# Zarr V3 storage
zarrs = { version = "0.22", optional = true, features = ["filesystem"] }
object_store = { version = "0.11", optional = true }

# Async & Logging
tokio = { workspace = true, features = ["sync", "fs"] }
tracing.workspace = true
anyhow.workspace = true

[dev-dependencies]
bytes = "1.5"
tempfile.workspace = true
tokio = { workspace = true, features = ["full"] }
chrono = { workspace = true, features = ["serde"] }
bincode = "1"

[features]
default = []
storage_hdf5 = ["dep:hdf5"]
storage_arrow = ["dep:arrow"]
storage_parquet = ["dep:parquet", "dep:arrow"]
storage_tiff = ["dep:image"]
storage_zarr = ["dep:zarrs", "dep:object_store"]
networking = []

# Examples that require specific features (bd-jnfu.13)
[lints]
workspace = true

[[example]]
name = "ring_arrow_bench"
required-features = ["storage_arrow"]
