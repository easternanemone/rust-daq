<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PVCAM: Common Functions</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="PM_logo_html.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">PVCAM
   &#160;<span id="projectnumber">3.10.x</span>
   </div>
   <div id="projectbrief">Programmable Virtual Camera Access Method library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_ex__common_functions.xhtml','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Common Functions </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>In order to reduce repetitive code, all code samples use additional structures and helper functions that are defined in separate source files. The most important types are documented in a separate chapter <a class="el" href="_ex__common_types.xhtml">Common Data Types</a>.</p>
<p>Please note that although PVCAM is a C99 API, the code samples in our SDK are written using C++11 features. This also helps to keep the code short and more readable.</p>
<h1><a class="anchor" id="secExErrors"></a>
Getting Error Messages</h1>
<p>All code samples use <code>PrintErrorMessage</code> to log an error. This function prints the most recent error condition (returned by <a class="el" href="group__grp__pm__functions.xhtml#gac6515369e2f1d4c940a61ba605648ee8" title="Returns the most recent error condition. ">pl_error_code</a> function) together with the related error message (received via <a class="el" href="group__grp__pm__functions.xhtml#ga65d31e874d7a856dfa336549008af5d8" title="Returns a string explaining input error code. ">pl_error_message</a> function). For more information please refer to <a class="el" href="_api_errors.xhtml">Error Handling</a> chapter. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> PrintErrorMessage(<a class="code" href="master_8h.xhtml#a4355d16fcf9f644c9ac84293f0b1801f">int16</a> errorCode, <span class="keyword">const</span> <span class="keywordtype">char</span>* message)</div><div class="line">{</div><div class="line">    <span class="keywordtype">char</span> pvcamErrMsg[<a class="code" href="pvcam_8h.xhtml#a73e3216fb5d7453e74727559c51b2582">ERROR_MSG_LEN</a>];</div><div class="line">    <a class="code" href="group__grp__pm__functions.xhtml#ga65d31e874d7a856dfa336549008af5d8">pl_error_message</a>(errorCode, pvcamErrMsg);</div><div class="line">    printf(<span class="stringliteral">&quot;%s\n  Error code: %d\n  Error message: %s\n&quot;</span>,</div><div class="line">            message, errorCode, pvcamErrMsg);</div><div class="line">}</div></div><!-- fragment --><h1><a class="anchor" id="secExInit"></a>
Initializing PVCAM and Opening the Camera</h1>
<p>General initialization is implemented inside <code>InitPVCAM</code> function. This function first calls the <a class="el" href="group__grp__pm__functions.xhtml#gae632f9831692d5ca256835bd7c449146" title="Opens and initializes the library. ">pl_pvcam_init</a> method, then, by calling <a class="el" href="group__grp__pm__functions.xhtml#ga8681c2a2b3c9671ba2246e3d9ae09c83" title="Returns the number of cameras attached to the system. ">pl_cam_get_total</a> it retrieves the number of cameras that are recognized by PVCAM. Finally, the function creates an instance of <a class="el" href="_ex__common_types.xhtml#CameraContext">CameraContext</a> structure for every camera. The structure is initially filled with camera name that is obtained using <a class="el" href="group__grp__pm__functions.xhtml#ga25493b00f001080b9768fd68716907a2" title="Returns the name of a camera. ">pl_cam_get_name</a> call.</p>
<p>Two more helper functions are used in order to further simplify the code samples: the first function opens one camera at a given index, the second function opens multiple cameras starting from index 0. </p><div class="fragment"><div class="line"><span class="keywordtype">bool</span> InitAndOpenOneCamera(std::vector&lt;CameraContext*&gt;&amp; contexts, <a class="code" href="master_8h.xhtml#a65d4f91467e0293f3598f24874963944">uns16</a> camIndex);</div><div class="line"><span class="keywordtype">bool</span> InitAndOpenMultipleCameras(std::vector&lt;CameraContext*&gt;&amp; contexts, <a class="code" href="master_8h.xhtml#a65d4f91467e0293f3598f24874963944">uns16</a>&amp; camCount);</div></div><!-- fragment --><h2><a class="anchor" id="ssecExInit"></a>
Initialize PVCAM Library</h2>
<p>Before calling any of the PVCAM API functions the library must be initialized. This only needs to be done once. <a class="el" href="_api_camera_enumeration.xhtml#secApiListInit">Initialization</a> section: </p><div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">bool</span> s_isPvcamInitialized = <span class="keyword">false</span>;</div><div class="line">...</div><div class="line">bool InitPVCAM(std::vector&lt;CameraContext*&gt;&amp; contexts)</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span> (s_isPvcamInitialized)</div><div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="master_8h.xhtml#a06fc87d81c62e9abb8790b6e5713c55ba54f3c24d6077e8aecf223c089f300d5b">PV_OK</a> != <a class="code" href="group__grp__pm__functions.xhtml#gae632f9831692d5ca256835bd7c449146">pl_pvcam_init</a>())</div><div class="line">    {</div><div class="line">        PrintErrorMessage(<a class="code" href="group__grp__pm__functions.xhtml#gac6515369e2f1d4c940a61ba605648ee8">pl_error_code</a>(), <span class="stringliteral">&quot;pl_pvcam_init() error&quot;</span>);</div><div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line">    }</div><div class="line">    s_isPvcamInitialized = <span class="keyword">true</span>;</div><div class="line">...</div></div><!-- fragment --> <dl class="section note"><dt>Note</dt><dd>For more information about PVCAM error handling, please refer to the <a class="el" href="_ex__common_functions.xhtml#secExErrors">Getting Error Messages</a> </dd>
<dd>
section. <a class="el" href="master_8h.xhtml#a06fc87d81c62e9abb8790b6e5713c55ba54f3c24d6077e8aecf223c089f300d5b">PV_OK</a> and <a class="el" href="master_8h.xhtml#a06fc87d81c62e9abb8790b6e5713c55baac97c0cdc2394919b7bf4dac68e4fa19">PV_FAIL</a> are synonyms for <a class="el" href="master_8h.xhtml#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a> and <a class="el" href="master_8h.xhtml#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a> value.</dd></dl>
<h2><a class="anchor" id="ssecExCamNum"></a>
Scan for Cameras</h2>
<p>Retrieve the number of cameras connected to the system. The order of cameras and their names follow a specific scheme, please see <a class="el" href="_api_camera_enumeration.xhtml#secApiListEnum">Camera Enumeration</a> for more details. </p><div class="fragment"><div class="line">...</div><div class="line">    <a class="code" href="master_8h.xhtml#a4355d16fcf9f644c9ac84293f0b1801f">int16</a> nrOfCameras = 0;</div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="master_8h.xhtml#a06fc87d81c62e9abb8790b6e5713c55ba54f3c24d6077e8aecf223c089f300d5b">PV_OK</a> != <a class="code" href="group__grp__pm__functions.xhtml#ga8681c2a2b3c9671ba2246e3d9ae09c83">pl_cam_get_total</a>(&amp;nrOfCameras))</div><div class="line">    {</div><div class="line">        PrintErrorMessage(<a class="code" href="group__grp__pm__functions.xhtml#gac6515369e2f1d4c940a61ba605648ee8">pl_error_code</a>(), <span class="stringliteral">&quot;pl_cam_get_total() error&quot;</span>);</div><div class="line">        UninitPVCAM(contexts);</div><div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">if</span> (nrOfCameras &lt;= 0)</div><div class="line">    {</div><div class="line">        printf(<span class="stringliteral">&quot;No cameras found in the system\n&quot;</span>);</div><div class="line">        UninitPVCAM(contexts);</div><div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line">    }</div><div class="line">...</div></div><!-- fragment --><h2><a class="anchor" id="ssecExCamNames"></a>
Create CameraContext for each camera</h2>
<div class="fragment"><div class="line">...</div><div class="line">    <span class="keywordflow">for</span> (<a class="code" href="master_8h.xhtml#a4355d16fcf9f644c9ac84293f0b1801f">int16</a> i = 0; i &lt; nrOfCameras; i++)</div><div class="line">    {</div><div class="line">        CameraContext* ctx = <span class="keyword">new</span> (std::nothrow) CameraContext();</div><div class="line">        <span class="keywordflow">if</span> (!ctx)</div><div class="line">        {</div><div class="line">            printf(<span class="stringliteral">&quot;Unable to allocate memory for CameraContext\n&quot;</span>);</div><div class="line">            UninitPVCAM(contexts);</div><div class="line">            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">if</span> (<a class="code" href="master_8h.xhtml#a06fc87d81c62e9abb8790b6e5713c55ba54f3c24d6077e8aecf223c089f300d5b">PV_OK</a> != <a class="code" href="group__grp__pm__functions.xhtml#ga25493b00f001080b9768fd68716907a2">pl_cam_get_name</a>(i, ctx-&gt;camName))</div><div class="line">        {</div><div class="line">            PrintErrorMessage(<a class="code" href="group__grp__pm__functions.xhtml#gac6515369e2f1d4c940a61ba605648ee8">pl_error_code</a>(), <span class="stringliteral">&quot;pl_cam_get_name() error&quot;</span>);</div><div class="line">            UninitPVCAM(contexts);</div><div class="line">            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line">        }</div><div class="line">        contexts.push_back(ctx);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line">}</div></div><!-- fragment --> <dl class="section note"><dt>Note</dt><dd>Retrieving the name of the camera is important since the name is used to open the camera.</dd></dl>
<h2><a class="anchor" id="ssecExCamOpen"></a>
Open the Camera</h2>
<div class="fragment"><div class="line"><span class="keywordtype">bool</span> OpenCamera(CameraContext* ctx)</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span> (ctx-&gt;isCamOpen)</div><div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="master_8h.xhtml#a06fc87d81c62e9abb8790b6e5713c55ba54f3c24d6077e8aecf223c089f300d5b">PV_OK</a> != <a class="code" href="group__grp__pm__functions.xhtml#ga4e716aa5d8e97e841887b3972c5ca75a">pl_cam_open</a>(ctx-&gt;camName, &amp;ctx-&gt;hcam, <a class="code" href="pvcam_8h.xhtml#ac75b747bbbd754a3965f7c49c2ebcaa9ab46afac993ac2bf924a89dceb70239d2">OPEN_EXCLUSIVE</a>))</div><div class="line">    {</div><div class="line">        PrintErrorMessage(<a class="code" href="group__grp__pm__functions.xhtml#gac6515369e2f1d4c940a61ba605648ee8">pl_error_code</a>(), <span class="stringliteral">&quot;pl_cam_open() error&quot;</span>);</div><div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line">    }</div><div class="line">    ctx-&gt;isCamOpen = <span class="keyword">true</span>;</div><div class="line"></div><div class="line">    ...</div><div class="line">    <span class="comment">// Initialize the rest of the CameraContext</span></div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line">}</div></div><!-- fragment --><p>The camera has been opened successfully. From now on, the <code>ctx-&gt;hcam</code> handle will be used to identify the camera when calling camera-specific API functions.</p>
<p>The <code>OpenCamera</code> function fully initializes the <a class="el" href="_ex__common_types.xhtml#CameraContext">CameraContext</a> structure and retrieves various camera information that do not change during camera operation. Such information may include:</p><ul>
<li>Camera imaging sensor size (<a class="el" href="group__grp__pm__parameters.xhtml#gabf27ea0423e1327bcbaf56faebf9ad56" title="The serial size of the sensor chip, in active columns. ">PARAM_SER_SIZE</a>, <a class="el" href="group__grp__pm__parameters.xhtml#ga3275987af794adf930eb19a0cb856739" title="The parallel size of the sensor chip, in active rows. ">PARAM_PAR_SIZE</a>)</li>
<li>Camera speed table (see <a class="el" href="_speed_table.xhtml">Port and Speed Choices</a>)</li>
<li>Firmware version (<a class="el" href="group__grp__pm__parameters.xhtml#ga02bbe84dfb365c23e876db3fbd9f838e" title="Returns the firmware version of the camera, as a hexadecimal number. ">PARAM_CAM_FW_VERSION</a>)</li>
<li>Imaging sensor name (<a class="el" href="group__grp__pm__parameters.xhtml#ga9e8c610d99ca8a565335abbcea47528c" title="The name of the sensor. ">PARAM_CHIP_NAME</a>)</li>
</ul>
<h1><a class="anchor" id="secExUninit"></a>
Closing Camera and Uninitializing PVCAM</h1>
<p>This function closes the camera if it has been opened previously. It's unlikely that the <a class="el" href="group__grp__pm__functions.xhtml#gabaaac4b7a60c157dbb90737b330d8f52" title="Frees the current camera, prepares it for power-down. ">pl_cam_close</a> call fails, but if it does, the camera is considered closed anyway. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> CloseCamera(CameraContext* ctx)</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span> (!ctx-&gt;isCamOpen)</div><div class="line">        <span class="keywordflow">return</span>;</div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="master_8h.xhtml#a06fc87d81c62e9abb8790b6e5713c55ba54f3c24d6077e8aecf223c089f300d5b">PV_OK</a> != <a class="code" href="group__grp__pm__functions.xhtml#gabaaac4b7a60c157dbb90737b330d8f52">pl_cam_close</a>(ctx-&gt;hcam))</div><div class="line">        PrintErrorMessage(<a class="code" href="group__grp__pm__functions.xhtml#gac6515369e2f1d4c940a61ba605648ee8">pl_error_code</a>(), <span class="stringliteral">&quot;pl_cam_close() error&quot;</span>);</div><div class="line">    ctx-&gt;isCamOpen = <span class="keyword">false</span>;</div><div class="line">}</div></div><!-- fragment --><p>PVCAM library is uninitialized via <code>UninitPVCAM</code> function. It calls <a class="el" href="group__grp__pm__functions.xhtml#gaff5e58cb92e94fb757509e071af30016" title="Closes the library, closes all devices, frees memory. ">pl_pvcam_uninit</a> after all <code>CameraContext</code> instances are released. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> UninitPVCAM(std::vector&lt;CameraContext*&gt;&amp; contexts)</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span> (!s_isPvcamInitialized)</div><div class="line">        <span class="keywordflow">return</span>;</div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> (CameraContext* ctx : contexts)</div><div class="line">        <span class="keyword">delete</span> ctx;</div><div class="line">    contexts.clear();</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="master_8h.xhtml#a06fc87d81c62e9abb8790b6e5713c55ba54f3c24d6077e8aecf223c089f300d5b">PV_OK</a> != <a class="code" href="group__grp__pm__functions.xhtml#gaff5e58cb92e94fb757509e071af30016">pl_pvcam_uninit</a>())</div><div class="line">        PrintErrorMessage(<a class="code" href="group__grp__pm__functions.xhtml#gac6515369e2f1d4c940a61ba605648ee8">pl_error_code</a>(), <span class="stringliteral">&quot;pl_pvcam_uninit() error&quot;</span>);</div><div class="line">    s_isPvcamInitialized = <span class="keyword">false</span>;</div><div class="line">}</div></div><!-- fragment --><p>Following is a function that closes all cameras and releases PVCAM library in one convenient call. This function is often used inside error handlers where a critical error leads to the immediate program interruption. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> CloseAllCamerasAndUninit(std::vector&lt;CameraContext*&gt;&amp; contexts);</div></div><!-- fragment --><h1><a class="anchor" id="secExAbortCliApp"></a>
Terminating the Application</h1>
<p>Several code examples in the SDK show how to use external hardware trigger feature. In order to cancel an acquisition that waits for the external trigger or long exposure acquisition, the example code uses the following function to install a termination handler. The handler is usually invoked by pressing Ctrl+C inside a running console application or system terminal. </p><div class="fragment"><div class="line"><span class="keywordflow">if</span> (!InstallGenericCliTerminationHandler(contexts))</div><div class="line">{</div><div class="line">    CloseAllCamerasAndUninit(contexts);</div><div class="line">    <span class="keywordflow">return</span> APP_EXIT_ERROR;</div><div class="line">}</div></div><!-- fragment --><h1><a class="anchor" id="secExParameters"></a>
Working With Parameters</h1>
<p>In the SDK code samples, PVCAM parameters are usually read by directly calling <a class="el" href="group__grp__pm__functions.xhtml#gabae50780da6c680d41331980f3135e55" title="Returns the requested attribute for a PVCAM parameter. ">pl_get_param</a> or <a class="el" href="group__grp__pm__functions.xhtml#gaa69957bd29e392a02e864239d956057a" title="Sets the current value for a PVCAM parameter. ">pl_set_param</a> functions without using additional wrappers. However, there are two exceptions made to improve the code readability: a check whether a particular parameter is available (function <code>IsParamAvaliable</code>), and an extraction of all values from an enumerable parameter (function <code>ReadEnumeration</code>).</p>
<p>The functions <code>IsParamAvailable</code> and <code>ReadEnumeration</code> accept <code>paramName</code> argument only to output the parameter name to console in case an error occurs. <a class="anchor" id="IsParamAvailable"></a><a class="anchor" id="ReadEnumeration"></a></p><div class="fragment"><div class="line"><span class="keywordtype">bool</span> IsParamAvailable(<a class="code" href="master_8h.xhtml#a4355d16fcf9f644c9ac84293f0b1801f">int16</a> hcam, <a class="code" href="master_8h.xhtml#ab84043a15f748ed8dfde8735af5b91d4">uns32</a> paramID, <span class="keyword">const</span> <span class="keywordtype">char</span>* paramName);</div><div class="line"><span class="keywordtype">bool</span> ReadEnumeration(<a class="code" href="master_8h.xhtml#a4355d16fcf9f644c9ac84293f0b1801f">int16</a> hcam, NVPC* pNvpc, <a class="code" href="master_8h.xhtml#ab84043a15f748ed8dfde8735af5b91d4">uns32</a> paramID, <span class="keyword">const</span> <span class="keywordtype">char</span>* paramName);</div></div><!-- fragment --><p>The details of these functions are documented in <a class="el" href="_api_parameters.xhtml">Parameter Access Functions</a> chapter and <a class="el" href="_api_parameters.xhtml#secApiParamEnum">Enumeration Parameters</a> section with error handling implementation.</p>
<h1><a class="anchor" id="secExCallbackHandler"></a>
Frame Callback Handler</h1>
<p>Most of the SDK code samples use the recommended 'callback' acquisition technique (see chapter <a class="el" href="_polling_vs_callbacks.xhtml">Polling versus Callbacks</a>). For callback acquisition the application must register a 'callback' function via the <a class="el" href="group__grp__pm__functions.xhtml#gade7bbd577d2ed19efc749c2d4dc7627a" title="Installs a handler function that will be called when an event occurs in a camera providing informatio...">pl_cam_register_callback_ex3</a> API call. The function below is used for the EOF (end-of-frame) callback notification and it is called by PVCAM automatically every time a frame is written into the frame buffer. For the purpose of SDK code samples, the function only unblocks another waiting thread. In any case, it is not recommended to do lengthy processing and hold this callback routine longer than necessary. An <code>std::conditional_variable</code> from standard library is used for that synchronization. <a class="anchor" id="GenericEofHandler"></a></p><div class="fragment"><div class="line"><span class="keywordtype">void</span> PV_DECL GenericEofHandler(<a class="code" href="struct___t_a_g___f_r_a_m_e___i_n_f_o.xhtml">FRAME_INFO</a>* pFrameInfo, <span class="keywordtype">void</span>* pContext)</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span> (!pContext)</div><div class="line">        <span class="keywordflow">return</span>;</div><div class="line">    <span class="keyword">auto</span> ctx = <span class="keyword">static_cast&lt;</span>CameraContext*<span class="keyword">&gt;</span>(pContext);</div><div class="line"></div><div class="line">    <span class="comment">// Store frame information for later use</span></div><div class="line">    ctx-&gt;eofFrameInfo = *pFrameInfo;</div><div class="line"></div><div class="line">    <span class="comment">// Obtain a pointer to the acquired frame</span></div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="master_8h.xhtml#a06fc87d81c62e9abb8790b6e5713c55ba54f3c24d6077e8aecf223c089f300d5b">PV_OK</a> != <a class="code" href="group__grp__pm__functions.xhtml#gacaf3f951e13c29c5eb6b17addfb82ae0">pl_exp_get_latest_frame</a>(ctx-&gt;hcam, &amp;ctx-&gt;eofFrame))</div><div class="line">    {</div><div class="line">        PrintErrorMessage(<a class="code" href="group__grp__pm__functions.xhtml#gac6515369e2f1d4c940a61ba605648ee8">pl_error_code</a>(), <span class="stringliteral">&quot;pl_exp_get_latest_frame() error&quot;</span>);</div><div class="line">        ctx-&gt;eofFrame = <span class="keyword">nullptr</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    { <span class="comment">// Unblock acquisition thread</span></div><div class="line">        std::lock_guard&lt;std::mutex&gt; lock(ctx-&gt;eofEvent.mutex);</div><div class="line">        ctx-&gt;eofEvent.flag = <span class="keyword">true</span>;</div><div class="line">    }</div><div class="line">    ctx-&gt;eofEvent.cond.notify_all();</div><div class="line">}</div></div><!-- fragment --><p>The callback is usually registered upon opening the camera and before starting any acquisition. </p><div class="fragment"><div class="line"><span class="keywordflow">if</span> (<a class="code" href="master_8h.xhtml#a06fc87d81c62e9abb8790b6e5713c55ba54f3c24d6077e8aecf223c089f300d5b">PV_OK</a> != <a class="code" href="group__grp__pm__functions.xhtml#gade7bbd577d2ed19efc749c2d4dc7627a">pl_cam_register_callback_ex3</a>(ctx-&gt;hcam, <a class="code" href="pvcam_8h.xhtml#a7f28494d7f16233fa9e8335c35970084a9bb1a7b24714c4dd210705a94a97b3c9">PL_CALLBACK_EOF</a>,</div><div class="line">            (<span class="keywordtype">void</span>*)GenericEofHandler, ctx))</div><div class="line">{</div><div class="line">    PrintErrorMessage(<a class="code" href="group__grp__pm__functions.xhtml#gac6515369e2f1d4c940a61ba605648ee8">pl_error_code</a>(), <span class="stringliteral">&quot;pl_cam_register_callback() error&quot;</span>);</div><div class="line">    CloseAllCamerasAndUninit(contexts);</div><div class="line">    <span class="keywordflow">return</span> APP_EXIT_ERROR;</div><div class="line">}</div></div><!-- fragment --><p>This is an implementation of a helper function that waits for the EOF event set in <a class="el" href="_ex__common_functions.xhtml#GenericEofHandler">GenericEofHandler</a> which effectively reduces the boiler-plate code that would be copied to most of the code samples using callbacks. <a class="anchor" id="WaitForEofEvent"></a></p><div class="fragment"><div class="line"><span class="keywordtype">bool</span> WaitForEofEvent(CameraContext* ctx, <a class="code" href="master_8h.xhtml#ab84043a15f748ed8dfde8735af5b91d4">uns32</a> timeoutMs, <span class="keywordtype">bool</span>&amp; errorOccurred)</div><div class="line">{</div><div class="line">    std::unique_lock&lt;std::mutex&gt; lock(ctx-&gt;eofEvent.mutex);</div><div class="line"></div><div class="line">    errorOccurred = <span class="keyword">false</span>;</div><div class="line">    ctx-&gt;eofEvent.cond.wait_for(lock, std::chrono::milliseconds(timeoutMs),</div><div class="line">            [ctx]() { <span class="keywordflow">return</span> ctx-&gt;eofEvent.flag || ctx-&gt;threadAbortFlag; });</div><div class="line">    <span class="keywordflow">if</span> (ctx-&gt;threadAbortFlag)</div><div class="line">    {</div><div class="line">        printf(<span class="stringliteral">&quot;Processing aborted on camera %d\n&quot;</span>, ctx-&gt;hcam);</div><div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">if</span> (!ctx-&gt;eofEvent.flag)</div><div class="line">    {</div><div class="line">        printf(<span class="stringliteral">&quot;Camera %d timed out waiting for a frame\n&quot;</span>, ctx-&gt;hcam);</div><div class="line">        errorOccurred = <span class="keyword">true</span>;</div><div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line">    }</div><div class="line">    ctx-&gt;eofEvent.flag = <span class="keyword">false</span>; <span class="comment">// Reset flag</span></div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (!ctx-&gt;eofFrame)</div><div class="line">    {</div><div class="line">        errorOccurred = <span class="keyword">true</span>;</div><div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line">}</div></div><!-- fragment --><h1><a class="anchor" id="secExUserInput"></a>
Interaction with User</h1>
<p>Each code sample has different requirements on how to interact with the user. The following functions provide means of interaction with the user via console application or system terminal.</p>
<p><code>GetCh</code> and <code>GetChE</code> functions are used for single key press detection. <a class="anchor" id="GetCh"></a><a class="anchor" id="GetChE"></a></p><div class="fragment"><div class="line"><span class="keywordtype">int</span> GetCh();</div><div class="line"><span class="keywordtype">int</span> GetChE();</div></div><!-- fragment --><p>Next two functions can be used to retrieve a string or numerical input. <a class="anchor" id="WaitForInputString"></a><a class="anchor" id="WaitForInputNumber"></a></p><div class="fragment"><div class="line"><span class="keywordtype">bool</span> WaitForInputString(std::string&amp; str);</div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</div><div class="line"><span class="keywordtype">bool</span> WaitForInputNumber(T min, T max, T def, T&amp; number)</div></div><!-- fragment --><p><code>GetMenuSelection</code> can be used to print a formatted menu with title and items from <a class="el" href="_ex__common_types.xhtml#NVPC">NVPC</a> structure. The user should enter one of the values from the <a class="el" href="_ex__common_types.xhtml#NVP">NVP</a> items for valid input. <a class="anchor" id="GetMenuSelection"></a></p><div class="fragment"><div class="line"><span class="keywordtype">bool</span> GetMenuSelection(<span class="keyword">const</span> std::string&amp; title, <span class="keyword">const</span> NVPC&amp; menu, <a class="code" href="master_8h.xhtml#a56f1a81c92849566ae864511088eb7e8">int32</a>&amp; selection);</div></div><!-- fragment --><h1><a class="anchor" id="secExUserOutput"></a>
Data Presentation</h1>
<p><code>ShowImage</code> function prints out the first few pixel values. The function is generic and its implementations shows how to process the pixel data for various image formats and bit-depths via C++ templates. <a class="anchor" id="UpdateCtxImageFormat"></a><a class="anchor" id="ShowImage"></a></p><div class="fragment"><div class="line"><span class="keywordtype">void</span> UpdateCtxImageFormat(CameraContext* ctx);</div><div class="line"><span class="keywordtype">void</span> ShowImage(<span class="keyword">const</span> CameraContext* ctx, <span class="keyword">const</span> <span class="keywordtype">void</span>* pBuffer,</div><div class="line">        <a class="code" href="master_8h.xhtml#ab84043a15f748ed8dfde8735af5b91d4">uns32</a> bufferBytes, <span class="keyword">const</span> <span class="keywordtype">char</span>* title = <span class="keyword">nullptr</span>);</div></div><!-- fragment --><p>The following set of functions prints out content of all metadata structures. See <a class="el" href="_embedded_frame_metadata.xhtml">Embedded Frame Metadata</a> chapter for details. <a class="anchor" id="PrintMetaFrame"></a><a class="anchor" id="PrintMetaRoi"></a><a class="anchor" id="PrintMetaExtMd"></a></p><div class="fragment"><div class="line"><span class="keywordtype">void</span> PrintMetaFrame(<span class="keyword">const</span> CameraContext* ctx, <span class="keyword">const</span> <a class="code" href="structmd__frame.xhtml">md_frame</a>* pFrameDesc,</div><div class="line">        <span class="keywordtype">bool</span> printAllRois);</div><div class="line"><span class="keywordtype">void</span> PrintMetaRoi(<span class="keyword">const</span> CameraContext* ctx, <span class="keyword">const</span> <a class="code" href="structmd__frame__roi.xhtml">md_frame_roi</a>* pRoiDesc);</div><div class="line"><span class="keywordtype">void</span> PrintMetaExtMd(<span class="keywordtype">void</span>* pMetaData, <a class="code" href="master_8h.xhtml#ab84043a15f748ed8dfde8735af5b91d4">uns32</a> metaDataSize);</div></div><!-- fragment --><p><code>SaveImage</code> writes raw image pixels to a file. <a class="anchor" id="SaveImage"></a></p><div class="fragment"><div class="line"><span class="keywordtype">bool</span> SaveImage(<span class="keyword">const</span> <span class="keywordtype">void</span>* pBuffer, <a class="code" href="master_8h.xhtml#ab84043a15f748ed8dfde8735af5b91d4">uns32</a> bufferBytes, <span class="keyword">const</span> <span class="keywordtype">char</span>* path);</div></div><!-- fragment --><h1><a class="anchor" id="secExPostProcessing"></a>
Post-Processing Helpers</h1>
<p>Please, read the <a class="el" href="_post_processing.xhtml">Post-Processing</a> chapter first to understand what post-processing is and how it is presented to application.</p>
<p>These helper functions simplify the access to post-processing functionality. <a class="anchor" id="DiscoverCameraPostProcessing"></a><a class="anchor" id="FindPpFeatureIndex"></a><a class="anchor" id="FindPpParamIndex"></a><a class="anchor" id="FindPpParamIndexes"></a><a class="anchor" id="GetPpParamValue"></a><a class="anchor" id="SetPpParamValue"></a></p><div class="fragment"><div class="line">std::vector&lt;PvcamPpFeature&gt; DiscoverCameraPostProcessing(CameraContext* ctx);</div><div class="line"></div><div class="line"><span class="keywordtype">bool</span> FindPpFeatureIndex(<span class="keyword">const</span> std::vector&lt;PvcamPpFeature&gt;&amp; ppFeatureList,</div><div class="line">        <a class="code" href="master_8h.xhtml#ab84043a15f748ed8dfde8735af5b91d4">uns32</a> ppFeatureId, <a class="code" href="master_8h.xhtml#a4355d16fcf9f644c9ac84293f0b1801f">int16</a>&amp; featIdx);</div><div class="line"><span class="keywordtype">bool</span> FindPpParamIndex(<span class="keyword">const</span> std::vector&lt;PvcamPpParameter&gt;&amp; ppParameterList,</div><div class="line">        <a class="code" href="master_8h.xhtml#ab84043a15f748ed8dfde8735af5b91d4">uns32</a> ppParamId, <a class="code" href="master_8h.xhtml#a4355d16fcf9f644c9ac84293f0b1801f">int16</a>&amp; paramIdx);</div><div class="line"><span class="keywordtype">bool</span> FindPpParamIndexes(<span class="keyword">const</span> std::vector&lt;PvcamPpFeature&gt;&amp; ppFeatureList,</div><div class="line">        <a class="code" href="master_8h.xhtml#ab84043a15f748ed8dfde8735af5b91d4">uns32</a> ppParamId, <a class="code" href="master_8h.xhtml#a4355d16fcf9f644c9ac84293f0b1801f">int16</a>&amp; featIdx, <a class="code" href="master_8h.xhtml#a4355d16fcf9f644c9ac84293f0b1801f">int16</a>&amp; paramIdx);</div><div class="line"></div><div class="line"><span class="keywordtype">bool</span> GetPpParamValue(CameraContext* ctx, <a class="code" href="master_8h.xhtml#a4355d16fcf9f644c9ac84293f0b1801f">int16</a> featIdx, <a class="code" href="master_8h.xhtml#a4355d16fcf9f644c9ac84293f0b1801f">int16</a> paramIdx, <a class="code" href="master_8h.xhtml#ab84043a15f748ed8dfde8735af5b91d4">uns32</a>&amp; value);</div><div class="line"><span class="keywordtype">bool</span> SetPpParamValue(CameraContext* ctx, <a class="code" href="master_8h.xhtml#a4355d16fcf9f644c9ac84293f0b1801f">int16</a> featIdx, <a class="code" href="master_8h.xhtml#a4355d16fcf9f644c9ac84293f0b1801f">int16</a> paramIdx, <a class="code" href="master_8h.xhtml#ab84043a15f748ed8dfde8735af5b91d4">uns32</a> value);</div></div><!-- fragment --><h1><a class="anchor" id="secExOthers"></a>
Other Helpers</h1>
<p>A helper function simplifying use of SMART Streaming feature <a class="anchor" id="UploadSmartStreamingExposures"></a></p><div class="fragment"><div class="line"><span class="keywordtype">bool</span> UploadSmartStreamingExposures(<span class="keyword">const</span> CameraContext* ctx,</div><div class="line">        <span class="keyword">const</span> <a class="code" href="master_8h.xhtml#ab84043a15f748ed8dfde8735af5b91d4">uns32</a>* pExposures, <a class="code" href="master_8h.xhtml#a65d4f91467e0293f3598f24874963944">uns16</a> exposuresCount);</div></div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="_example_guides.xhtml">Code Example Guides</a></li>
    <li class="footer">
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a></li>
  </ul>
</div>
</body>
</html>
