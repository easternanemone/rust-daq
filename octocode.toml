# Octocode Configuration for rust-daq project
version = 1

# OpenRouter is used for LLM-powered features.
# Get your free API key from https://openrouter.ai/keys
[openrouter]
# It's recommended to set the OPENROUTER_API_KEY environment variable.
# You can also uncomment the line below and add your key here.
# api_key = "YOUR_OPENROUTER_API_KEY"
model = "anthropic/claude-3.5-sonnet"
base_url = "https://openrouter.ai/api/v1"
timeout = 120

[index]
# Larger chunk size for better context in a dense Rust project.
chunk_size = 4000
chunk_overlap = 400
embeddings_batch_size = 16
embeddings_max_tokens_per_batch = 100000
flush_frequency = 2
# Ensures that the project is a git repository, which is true for rust-daq.
require_git = true

[search]
# More results for broader context.
max_results = 30
# Higher similarity threshold for more relevant results.
similarity_threshold = 0.7
output_format = "markdown"
max_files = 20
context_lines = 3
search_block_max_characters = 400

[embedding]
# State-of-the-art models for code and text embeddings.
code_model = "voyage:voyage-code-2"
text_model = "voyage:voyage-large-2"

# GraphRAG for knowledge graph generation.
[graphrag]
enabled = true
use_llm = true

[graphrag.llm]
description_model = "anthropic/claude-3.5-sonnet"
relationship_model = "anthropic/claude-3.5-sonnet"
ai_batch_size = 8
max_batch_tokens = 16384
batch_timeout_seconds = 60
fallback_to_individual = true
max_sample_tokens = 1500
confidence_threshold = 0.6
architectural_weight = 0.9
relationship_system_prompt = '''You are an expert software architect specializing in code analysis. Analyze the provided code files and identify meaningful ARCHITECTURAL relationships that go beyond simple imports. Focus on these relationship types:
- 'imports':Module/package imports and dependencies - 'implements':Interface implementation,trait implementation - 'extends':Class inheritance,module extension - 'calls':Function/method calls between modules - 'uses':Utility usage,service consumption - 'configures':Configuration setup,dependency injection - 'factory_creates':Factory pattern instantiation - 'observer_pattern':Event listening,callback registration - 'strategy_pattern':Algorithm selection,behavior delegation - 'adapter_pattern':Interface adaptation,wrapper usage - 'architectural_dependency':High-level system dependencies Respond with a JSON array of relationships. Each relationship must include:
- source_path:relative path of source file - target_path:relative path of target file - relation_type:one of the types listed above - description:specific explanation of HOW the relationship works - confidence:0.0-1.0 confidence score (use 0.8+ for clear relationships) Only include relationships with clear architectural significance. Avoid trivial imports.'''
description_system_prompt = '''You are a senior software engineer analyzing code architecture. Provide a concise 2-3 sentence description of the file's ROLE and PURPOSE in the system. Focus on:
- What architectural layer this file belongs to (API,business logic,data access,utilities,etc.) - Its primary responsibility and how it contributes to the system - Key patterns or architectural decisions it implements Avoid listing specific functions/classes. Instead,describe the file's architectural significance and how it fits into the larger system design.'''
