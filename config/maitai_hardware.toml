# Maitai Lab Hardware Configuration for rust-daq
#
# Real hardware configuration for the remote machine at 100.117.5.12
# This file configures all instruments in the maitai lab.
#
# Usage:
#   rust-daq-daemon daemon --hardware-config config/maitai_hardware.toml
#
# Hardware Inventory:
#   - Prime BSI Camera (PVCAM)
#   - 3x ELL14 Rotators (RS-485 bus via FT230X serial DK0AHAJZ)
#   - MaiTai Ti:Sapphire Laser (CP2102 serial 0001)
#   - Newport 1830-C Power Meter (/dev/ttyS0)
#   - ESP300 Motion Controller (FTDI 4-port serial FT1RALWL)
#
# USB Serial by-id Mapping (stable across reboots, verified 2026-01-17):
#   MaiTai:  usb-Silicon_Labs_CP2102_USB_to_UART_Bridge_Controller_0001-if00-port0
#   ELL14:   usb-FTDI_FT230X_Basic_UART_DK0AHAJZ-if00-port0
#   ESP300:  usb-FTDI_USB__-__Serial_Cable_FT1RALWL-if00-port0

# ============================================================================
# Photometrics Prime BSI Camera (PVCAM)
# ============================================================================
# Requires: pvcam_hardware feature and PVCAM SDK environment variables
# Resolution: 2048x2048, 16-bit

[[devices]]
id = "prime_bsi"
name = "Photometrics Prime BSI Camera"
[devices.driver]
type = "pvcam"
camera_name = "pvcamUSB_0"

# ============================================================================
# Thorlabs ELL14 Rotation Mounts (RS-485 Multidrop Bus)
# ============================================================================
# Three rotators share one serial connection at /dev/ttyUSB2 (FT230X)
# Addresses: 2, 3, 8 (set via Thorlabs software)

[[devices]]
id = "rotator_2"
name = "ELL14 Rotator (Address 2)"
[devices.driver]
type = "ell14"
port = "/dev/serial/by-id/usb-FTDI_FT230X_Basic_UART_DK0AHAJZ-if00-port0"
address = "2"

[[devices]]
id = "rotator_3"
name = "ELL14 Rotator (Address 3)"
[devices.driver]
type = "ell14"
port = "/dev/serial/by-id/usb-FTDI_FT230X_Basic_UART_DK0AHAJZ-if00-port0"
address = "3"

[[devices]]
id = "rotator_8"
name = "ELL14 Rotator (Address 8)"
[devices.driver]
type = "ell14"
port = "/dev/serial/by-id/usb-FTDI_FT230X_Basic_UART_DK0AHAJZ-if00-port0"
address = "8"

# ============================================================================
# Spectra-Physics MaiTai Ti:Sapphire Laser
# ============================================================================
# Serial control for wavelength tuning (690-1040nm)
# USB-to-USB connection at 115200 baud (faster than RS-232)

[[devices]]
id = "maitai"
name = "MaiTai Ti:Sapphire Laser"
[devices.driver]
type = "mai_tai"
port = "/dev/serial/by-id/usb-Silicon_Labs_CP2102_USB_to_UART_Bridge_Controller_0001-if00-port0"
# USB-to-USB connection: 115200 baud, 8N1, no flow control (driver defaults)

# ============================================================================
# Newport 1830-C Optical Power Meter
# ============================================================================
# Connected via built-in serial port (RS-232)

[[devices]]
id = "power_meter"
name = "Newport 1830-C Power Meter"
[devices.driver]
type = "newport1830_c"
port = "/dev/ttyS0"

# ============================================================================
# Newport ESP300 Motion Controller
# ============================================================================
# 3-axis motion controller via FTDI 4-port cable
# Note: ESP300 didn't respond during 2026-01-17 testing - may need verification

[[devices]]
id = "esp300_axis1"
name = "ESP300 Axis 1"
[devices.driver]
type = "esp300"
port = "/dev/serial/by-id/usb-FTDI_USB__-__Serial_Cable_FT1RALWL-if00-port0"
axis = 1

[[devices]]
id = "esp300_axis2"
name = "ESP300 Axis 2"
[devices.driver]
type = "esp300"
port = "/dev/serial/by-id/usb-FTDI_USB__-__Serial_Cable_FT1RALWL-if00-port0"
axis = 2

[[devices]]
id = "esp300_axis3"
name = "ESP300 Axis 3"
[devices.driver]
type = "esp300"
port = "/dev/serial/by-id/usb-FTDI_USB__-__Serial_Cable_FT1RALWL-if00-port0"
axis = 3

# ============================================================================
# Comedi DAQ Card (NI PCI-MIO-16XE-10)
# ============================================================================
# Analog input/output channels via BNC-2110 terminal block
#
# Hardware connections (verified 2026-01-23):
#   DAC1-OUT → ACH0 (loopback test, ~50mV error)
#   ACH1 → ESP300 encoder out (4.78V signal)
#   ACH2 → MaiTai reference out (DC average ~0V for 40MHz signal)
#   DAC0-OUT → EOM amplifier (for laser power control)

[[devices]]
id = "photodiode"
name = "Photodiode Signal (ACH0)"
[devices.driver]
type = "comedi_analog_input"
device = "/dev/comedi0"
channel = 0
range_index = 0
input_mode = "rse"
units = "V"

[[devices]]
id = "ni_daq_ao0"
name = "NI DAQ Analog Output 0 (EOM Control)"
[devices.driver]
type = "comedi_analog_output"
device = "/dev/comedi0"
channel = 0
range_index = 0
units = "V"

[[devices]]
id = "ni_daq_ao1"
name = "NI DAQ Analog Output 1 (Loopback Test)"
[devices.driver]
type = "comedi_analog_output"
device = "/dev/comedi0"
channel = 1
range_index = 0
units = "V"
