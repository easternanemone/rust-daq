metadata:
  id: "test-device-mock"
  name: "Mock Test Device"
  version: "1.0.0"
  driver_type: "serial_scpi"

protocol:
  baud_rate: 9600
  termination: "\r\n"
  command_delay_ms: 10
  timeout_ms: 500

on_connect:
  - cmd: "*IDN?"
    wait_ms: 10
  - cmd: "RST"
  - cmd: "SYST:REM"

on_disconnect:
  - cmd: "SYST:LOC"

error_patterns:
  - "ERROR"
  - "INVALID COMMAND"

capabilities:
  movable:
    axes:
      - name: "x"
        unit: "mm"
        min: 0.0
        max: 100.0
      - name: "y"
        unit: "mm"
        min: 0.0
        max: 100.0
    set_cmd: "POS:{axis} {val}"  # Example: "POS:x 50.5"
    get_cmd: "POS:{axis}?"        # Example: "POS:x?"
    get_pattern: "{val:f}"        # Expects just the position value

  readable:
    - name: "temperature"
      command: "TEMP?"
      pattern: "TEMP:{val:f}" # Expects "TEMP:25.5"
      unit: "C"
      mock:
        default: 22.5
        jitter: 0.5
    - name: "humidity"
      command: "HUM?"
      pattern: "HUM:{val:f}%" # Expects "HUM:60.0%"
      unit: "%"
      mock:
        default: 55.0
        jitter: 1.0

  settable:
    - name: "setpoint_temp"
      set_cmd: "TEMP:SET {val}"
      get_cmd: "TEMP:SET?"
      pattern: "{val:f}"
      value_type: float
      unit: "C"
      min: 10.0
      max: 40.0
      mock:
        default: 25.0
        jitter: 0.1
    - name: "fan_mode"
      set_cmd: "FAN:MODE {val}"
      get_cmd: "FAN:MODE?"
      pattern: "{val}"
      value_type: enum
      options: ["AUTO", "HIGH", "LOW"]

  switchable:
    - name: "heater"
      on_cmd: "HEAT ON"
      off_cmd: "HEAT OFF"
      status_cmd: "HEAT?"
      pattern: "{val}" # Expects "ON" or "OFF"

  actionable:
    - name: "calibrate"
      cmd: "CAL"
      wait_ms: 5000 # Long calibration

  loggable:
    - name: "serial_number"
      cmd: "*SN?"
      pattern: "SN:{val}"

ui_layout:
  - type: "group"
    label: "Environmental Control"
    children:
      - type: "readout"
        source: "temperature"
        label: "Current Temperature"
      - type: "slider"
        target: "setpoint_temp"
        label: "Temperature Setpoint"
      - type: "toggle"
        target: "heater"
        label: "Heater On/Off"
      - type: "button"
        action: "calibrate"
        label: "Run Calibration"
      - type: "dropdown"
        target: "fan_mode"
        label: "Fan Operation Mode"
